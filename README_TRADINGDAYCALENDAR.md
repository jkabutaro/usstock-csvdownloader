# 取引日カレンダー機能の実装について

## 概要

このアップデートでは、`^DJI`（ダウ・ジョーンズ工業株価平均）のデータをマスターカレンダーとして使用し、米国市場の休業日を効率的に判定する機能を実装しました。これにより、休業日に対する不要なデータ取得リクエストが削減され、より効率的にデータを取得できるようになりました。

## 主な機能

1. **TradingDayCalendarService**
   - ^DJIのデータを使用して取引日カレンダーを維持
   - 取引日のリストを提供
   - 日付が取引日かどうかの判定
   - 次の取引日・前の取引日の取得

2. **StockDataService の改良**
   - ^DJIをマスターカレンダーとして特別扱い
   - 取引日カレンダーを使用した欠けているデータ範囲の特定
   - 休業日を除外したデータ取得

## 使用方法

特に設定は不要です。システムは自動的に以下のように動作します：

1. 最初に^DJIのデータを取得して取引日カレンダーを初期化
2. 他の銘柄のデータ取得時には、取引日のみを含む範囲でYahooにリクエスト
3. 休業日が自動的に除外され、効率的にデータを取得

## 技術的詳細

1. **取引日カレンダーの初期化**
   - 過去3年分のカレンダーを初期化
   - ^DJIデータ取得時に自動的に更新

2. **データ取得の最適化**
   - キャッシュに欠けている範囲の特定時に取引日カレンダーを参照
   - 取引日のみを含む最小範囲を計算
   - 休業日を除外することでリクエスト回数を削減

3. **循環参照の回避**
   - StockDataService と TradingDayCalendarService の相互参照に対処
   - 遅延初期化パターンを使用

## メリット

- 不要なリクエストの削減によるYahoo Finance APIへの負担軽減
- レート制限への対応改善
- 全体的なデータ取得速度の向上
- キャッシュヒット率の向上

これらの改良により、より効率的かつ安定したデータ取得が可能になりました。
