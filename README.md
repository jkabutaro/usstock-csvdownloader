# US Stock Price Downloader

Yahoo Finance APIを使用して、S&P 500やNYダウなどの株価データをダウンロードするツールです。

## 機能

- S&P 500銘柄の自動取得とダウンロード
- NYダウ銘柄の自動取得とダウンロード
- カスタム銘柄リストからのダウンロード
- 並列ダウンロードによる高速化
- エラー時の自動リトライ
- レート制限への対応
- CSVフォーマットでのデータ保存

## 使い方

```bash
# S&P 500銘柄のダウンロード
dotnet run -- --sp500

# NYダウ銘柄のダウンロード
dotnet run -- --nyd

# カスタム銘柄リストからのダウンロード
dotnet run -- --file symbols.txt
```

## オプション

- `--sp500`: S&P 500銘柄をダウンロード
- `--nyd`: NYダウ銘柄をダウンロード
- `--file <path>`: 指定したファイルから銘柄リストを読み込み
- `--max-concurrent <num>`: 並列ダウンロード数（デフォルト: 3）
- `--max-retries <num>`: リトライ回数（デフォルト: 3）
- `--retry-delay <ms>`: リトライ間隔（ミリ秒、デフォルト: 1000）
- `--exponential-backoff`: 指数バックオフを使用（デフォルト: true）

## エラー処理

- HTTP 429（レート制限）: 60秒待機後に再試行
- その他のエラー: 設定された間隔で再試行
- 指数バックオフ: リトライ毎に待機時間を2倍に
- ジッター: 同時リトライを分散させるためのランダム遅延

## データ形式

ダウンロードしたデータは `Data` ディレクトリに銘柄ごとのCSVファイルとして保存されます。

```csv
Symbol,Date,Open,High,Low,Close,Volume
AAPL,2024-02-25,180.15,182.34,179.89,181.56,75234567
```

## キャッシュ

S&P 500とNYダウの銘柄リストは `Cache` ディレクトリにキャッシュされ、再利用されます。

## 注意事項

- ピリオドを含む銘柄（BRK.B、BF.B）は特別な処理が必要
- 一部の銘柄でデータが欠落する可能性あり
- Yahoo Finance APIの利用制限に注意

## 依存関係

- .NET 9.0
- Polly: リトライ処理
- CsvHelper: CSV操作
- HtmlAgilityPack: HTML解析
