# US Stock Price Downloader

米国株価のヒストリカルデータをCSVでダウンロードするWindowsアプリケーション

## 主な機能

- S&P 500銘柄の株価データを自動ダウンロード
- 複数銘柄の並列ダウンロードによる高速処理（デフォルト3並列）
- 柔軟なシンボル形式対応（NYSE、NASDAQ等）
- エラー発生時の自動リトライ機能
- 詳細なログ出力
- CSVフォーマットでのデータ保存

## 開発環境

- .NET 8.0
- C#
- Windows

## セットアップ

1. リポジトリをクローン:
```bash
git clone [your-repository-url]
```

2. プロジェクトディレクトリに移動:
```bash
cd USStockDownloader
```

3. アプリケーションをビルド:
```bash
dotnet build
```

4. アプリケーションを実行:
```bash
dotnet run
```

## コマンドライン引数

アプリケーションは以下のコマンドライン引数をサポートしています：

| 短縮形 | 完全形 | 必須 | デフォルト値 | 説明 |
|--------|--------|------|--------------|------|
| -f | --file | いいえ* | - | 銘柄シンボルが記載されたファイルのパス |
| -s | --sp500 | いいえ* | false | S&P 500銘柄を自動的にダウンロード |
| - | --sp500f | いいえ | false | S&P 500銘柄リストを強制的に更新 |
| -p | --parallel | いいえ | 3 | 並列ダウンロード数（最大10） |
| -r | --retries | いいえ | 3 | 銘柄ごとの最大リトライ回数 |
| -d | --delay | いいえ | 1000 | リトライ間の待機時間（ミリ秒、最小100ms） |
| -e | --exponential | いいえ | true | 指数バックオフの使用（true/false） |

\* `-f`または`-s`のいずれかが必要です

### S&P 500シンボルの取得について

- `--sp500`オプションを使用すると、S&P 500構成銘柄を自動的にダウンロードします
  - 初回実行時はWikipediaから最新のリストを取得します
  - 2回目以降は保存されたリストを使用します（高速）
- `--sp500f`オプションを使用すると、キャッシュを無視して強制的に最新のリストを取得します

### キャッシュ機能について

- S&P 500銘柄リストはローカルにキャッシュされます
- キャッシュは`--sp500f`オプションで強制的に更新できます

### 制限事項

- 並列ダウンロード数は最大10に制限されています（レート制限回避のため）
- リトライ間の待機時間は最小100ミリ秒必要です
- データ取得期間は自動的に現在から1年前までに設定されます

### 使用例

1. S&P 500銘柄の自動ダウンロード:
```bash
dotnet run -- -s
```

2. S&P 500銘柄を強制的に最新化してダウンロード:
```bash
dotnet run -- -s --sp500f
```

3. S&P 500銘柄を並列数5でダウンロード:
```bash
dotnet run -- -s -p 5
```

4. カスタム銘柄リストを使用:
```bash
dotnet run -- -f symbols.txt
```

5. カスタム銘柄リストを並列数とリトライ回数を指定してダウンロード:
```bash
dotnet run -- -f symbols.txt -p 5 -r 5
```

6. リトライ設定のカスタマイズ:
```bash
dotnet run -- -f symbols.txt -d 2000 -e false
```

## 入力ファイル形式

### シンボルファイル（symbols.txt）
- 1行に1つのシンボルを記載
- 空行は無視されます
- `#`で始まる行はコメントとして扱われます

例：
```
# カスタム銘柄リスト
AAPL
MSFT
GOOGL
BRK.B
```

## 出力ファイル形式

### CSVファイル
ダウンロードされたデータは以下の形式でCSVファイルに保存されます：

```csv
Date,Open,High,Low,Close,Volume
2024-02-25,190.23,191.45,189.89,190.12,123456
```

各カラムの説明：
- Date: 取引日（YYYY-MM-DD形式）
- Open: 始値（USD）
- High: 高値（USD）
- Low: 安値（USD）
- Close: 終値（USD）
- Volume: 出来高

## ライセンス

MIT
